services:
  # Redis
  - type: pserv
    name: redis
    env: docker
    plan: starter
    dockerfilePath: ./redis/Dockerfile
    dockerContext: ./redis/
    disk:
      name: data
      mountPath: /var/lib/redis
      sizeGB: 10

  # Medusa
  - type: web
    name: medusa-api
    env: docker
    plan: starter
    dockerfilePath: ./packages/medusa-api/Dockerfile
    dockerContext: .
    domains:
      - store.themontessoriwoodshop.com
    envVars:
      - fromGroup: medusa
      - fromGroup: auth-secrets
      - fromGroup: cloudflare
      - key: MEDUSA_DATABASE_URL
        fromDatabase:
          name: medusa_db
          property: connectionString
      - key: MEDUSA_REDIS_HOST
        fromService:
          name: redis
          type: pserv
          property: host
      - key: MEDUSA_REDIS_PORT
        fromService:
          name: redis
          type: pserv
          property: port

# Env Var Groups
envVarGroups:
  - name: medusa
    envVars:
      - key: MEDUSA_PORT
        value: 9000
      - key: MEDUSA_ADMIN_CORS
        value: https://admin.themontessoriwoodshop.com
      - key: MEDUSA_STORE_CORS
        value: https://themontessoriwoodshop.com
  - name: auth-secrets
    envVars:
      - key: JWT_SECRET
        sync: false
      - key: COOKIE_SECRET
        sync: false
  - name: cloudflare
    envVars:
      - key: CF_ZONE_ID
        sync: false
      - key: CF_ACCOUNT_ID
        sync: false
      - key: CF_IMAGE_API_TOKEN
        sync: false
  - name: content
    envVars:
      - key: CONTENT_DB_URL
        sync: false

# Postgres DB
databases:
  - name: woodshop_db
    databaseName: woodshop_db
    plan: starter
    user: content_user
    region: oregon
    postgresMajorVersion: 14
  - name: medusa_db
    plan: starter
    databaseName: medusa_db
    user: store_user
    region: oregon
    postgresMajorVersion: 14
    





    